<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSID LAB - Research Platform</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ root_path }}/static/css/login.css">
</head>
<body class="login-page">
    <div class="login-container">
        <!-- Left: Hero/Branding -->
        <div class="login-hero">
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="ri-flask-line"></i>
                    Research Note Platform
                </div>
                
                <!-- PSID Logo -->
                <div class="hero-logo-img">
                    <img src="{{ root_path }}/static/images/PSID.png" alt="PSID LAB" />
                </div>
                
                <p class="hero-subtitle">Process Systems & Informatics Design Laboratory</p>
                <p>연구 노트와 실험 데이터를 체계적으로 관리하고,<br>팀과 효율적으로 협업하세요.</p>
                
                <div class="hero-features">
                    <div class="feature">
                        <i class="ri-file-text-line"></i>
                        <span>마크다운 기반 연구 노트 작성</span>
                    </div>
                    <div class="feature">
                        <i class="ri-folder-shared-line"></i>
                        <span>프로젝트별 워크스페이스 관리</span>
                    </div>
                    <div class="feature">
                        <i class="ri-search-eye-line"></i>
                        <span>강력한 전문 검색 기능</span>
                    </div>
                </div>
                
                <!-- Partner Logos -->
                <div class="partner-logos">
                    <img src="{{ root_path }}/static/images/logo_khu.png" alt="Kyung Hee University" />
                    <img src="{{ root_path }}/static/images/logo_hanyang.png" alt="Hanyang University" />
                    <img src="{{ root_path }}/static/images/logo_kitech.png" alt="KITECH" />
                </div>
            </div>
            
            <div class="hero-background">
                <div class="gradient-orb orb-1"></div>
                <div class="gradient-orb orb-2"></div>
                <div class="gradient-orb orb-3"></div>
            </div>
        </div>
        
        <!-- Right: Login Form -->
        <div class="login-form-container">
            <div class="login-form-wrapper">
                <div class="login-header">
                    <h2>로그인</h2>
                    <p>연구 플랫폼에 접속하세요</p>
                </div>
                
                <form class="login-form" id="login-form">
                    <div class="form-group">
                        <label for="email">이메일 또는 사용자명</label>
                        <div class="input-wrapper">
                            <i class="ri-user-line"></i>
                            <input type="text" id="email" name="email_or_username" 
                                   placeholder="이메일 또는 사용자명" required autofocus>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">비밀번호</label>
                        <div class="input-wrapper">
                            <i class="ri-lock-line"></i>
                            <input type="password" id="password" name="password" 
                                   placeholder="비밀번호" required>
                            <button type="button" class="password-toggle" id="password-toggle">
                                <i class="ri-eye-line"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="remember" name="remember">
                            <span>로그인 상태 유지</span>
                        </label>
                        <a href="{{ root_path }}/forgot-password" class="forgot-link">비밀번호 찾기</a>
                    </div>
                    
                    <div class="error-message" id="error-message" style="display: none;"></div>
                    
                    <button type="submit" class="btn-primary" id="login-btn">
                        <span>로그인</span>
                        <i class="ri-arrow-right-line"></i>
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>계정이 없으신가요? <a href="{{ root_path }}/register">회원가입</a></p>
                </div>
            </div>
            
            <div class="login-copyright">
                <p>&copy; 2026 PSID LAB. All rights reserved.</p>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('login-form');
        const errorMsg = document.getElementById('error-message');
        const passwordToggle = document.getElementById('password-toggle');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        
        passwordToggle.addEventListener('click', function() {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            this.querySelector('i').className = type === 'password' ? 'ri-eye-line' : 'ri-eye-off-line';
        });
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            loginBtn.classList.add('loading');
            loginBtn.disabled = true;
            errorMsg.style.display = 'none';
            
            const formData = new FormData(form);
            const data = {
                email_or_username: formData.get('email_or_username'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch('/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    localStorage.setItem('access_token', result.access_token);
                    localStorage.setItem('refresh_token', result.refresh_token);
                    localStorage.setItem('user', JSON.stringify(result.user));
                    window.location.href = './';
                } else {
                    const error = await response.json();
                    errorMsg.textContent = error.detail || '로그인에 실패했습니다.';
                    errorMsg.style.display = 'block';
                }
            } catch (err) {
                errorMsg.textContent = '서버 연결에 실패했습니다.';
                errorMsg.style.display = 'block';
            } finally {
                loginBtn.classList.remove('loading');
                loginBtn.disabled = false;
            }
        });
    });
    </script>
</body>
</html>

