{% extends "base.html" %}
{% block title %}Search - Research Platform{% endblock %}
{% block content %}
<div class="search-page">
    <div class="page-header"><h1>Search</h1></div>
    <div class="search-input-wrapper">
        <i class="ri-search-line"></i>
        <input type="text" id="search-input" placeholder="Search documents..." autofocus>
    </div>
    <div id="search-results"></div>
</div>
{% endblock %}
{% block extra_scripts %}
<script>
let searchTimeout;
const input = document.getElementById('search-input');
const results = document.getElementById('search-results');

input?.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(doSearch, 300);
});

async function doSearch() {
    const q = input.value.trim();
    if (!q) { results.innerHTML = ''; return; }
    try {
        const docs = await api.get(`/documents?search=${encodeURIComponent(q)}&limit=20`);
        const items = docs.items || docs;
        if (!items || items.length === 0) {
            results.innerHTML = '<div class="empty-state"><i class="ri-search-line"></i><span>No results found</span></div>';
            return;
        }
        results.innerHTML = items.map(doc => `
            <a href="${appUrl('/documents/' + doc.id)}" class="search-result-item" style="display:block;text-decoration:none;color:inherit;">
                <div class="search-result-title">${doc.icon || 'ðŸ“„'} ${escapeHtml(doc.title || 'Untitled')}</div>
                <div class="search-result-snippet">${escapeHtml((doc.summary || doc.content || '').substring(0, 150))}${(doc.content || '').length > 150 ? '...' : ''}</div>
                <div class="search-result-meta">${formatDate(doc.updated_at)}</div>
            </a>
        `).join('');
    } catch (e) { results.innerHTML = '<div class="empty-state"><i class="ri-error-warning-line"></i><span>Search failed</span></div>'; }
}
// Auto-focus search from URL params
const params = new URLSearchParams(window.location.search);
if (params.get('q')) { input.value = params.get('q'); doSearch(); }
</script>
{% endblock %}
