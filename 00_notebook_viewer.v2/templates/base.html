<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- âœ… ëª¨ë°”ì¼ ëŒ€ì‘ì„ ìœ„í•œ viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{{ title if title else "ì—°êµ¬ë…¸íŠ¸ ë·°ì–´" }}</title>

  <!-- âœ… FastAPI StaticFiles: /research/static/style.css -->
  <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">

  <style>
    /* =========================
       âœ… ì „ì—­ í°íŠ¸ ì„¤ì •
       - 1ìˆœìœ„: Microsoft NeoGothic
       - ì—†ìœ¼ë©´ fallbackìœ¼ë¡œ ë‚´ë ¤ê°
       ========================= */
    :root{
      --app-font: "Microsoft NeoGothic", "Microsoft Neogothic",
                  "Malgun Gothic", "ë§‘ì€ ê³ ë”•",
                  "Apple SD Gothic Neo",
                  "Noto Sans KR",
                  "Segoe UI",
                  Arial, sans-serif;
    }

    html, body{
      font-family: var(--app-font);
      font-size: 16px;
      line-height: 1.5;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
      html, body,
  .header, .main, .main-inner,
  .viewer-layout, .viewer-main, .viewer-sidebar,
  .markdown-body,
  .project-card, .detail-header,
  button, input, textarea, select {
    font-family: var(--app-font) !important;
  }

  /* ì½”ë“œë¸”ë¡ì€ ê°€ë…ì„± ìœ„í•´ monospace ìœ ì§€(ì›í•˜ë©´ ì‚­ì œ ê°€ëŠ¥) */
  pre, code, kbd, samp {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  }
    /* âœ… form ìš”ì†Œ/ë²„íŠ¼ë„ í°íŠ¸ ìƒì† ë³´ì¥ */
    input, button, textarea, select{
      font: inherit;
    }

    /* ìµœì†Œ ë‹¤í¬ëª¨ë“œ override */
    body.dark {
      background: #111;
      color: #eee;
    }
    body.dark a {
      color: #9cd;
    }
    body.dark .header {
      background: #000;
    }
    body.dark .project-card {
      background: #222;
      border-color: #444;
    }

    .header-nav {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 0.9rem;
      flex-wrap: wrap; /* ëª¨ë°”ì¼ì—ì„œ ìë™ ì¤„ë°”ê¿ˆ */
    }
    .header-nav a {
      text-decoration: none;
    }
    #theme-toggle {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 1.1rem;
    }
    .header-user {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    /* í”„ë¦¬ë·° ì»¤ì„œ ìœ„ì¹˜ ë§ˆì»¤ (ëˆˆì—ëŠ” ì•ˆ ë³´ì´ê²Œ) */
    #__cursor_marker__ {
      display: block;
      height: 0;
      margin: 0;
      padding: 0;
      border: 0;
    }

    /* í—¤ë” ë ˆì´ì•„ì›ƒ: ëª¨ë°”ì¼ì—ì„œ ì„¸ë¡œ ì •ë ¬ */
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 12px;
      box-sizing: border-box;
    }

    .logo a {
      text-decoration: none;
      color: inherit;
      font-size: 1.1rem;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .header-inner {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-nav {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>

<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<body>
  <!-- <div style="position:fixed;top:8px;right:8px;z-index:99999;background:#ff1744;color:#fff;padding:6px 10px;border-radius:8px;font-weight:800;">
  viewer v-TEST
</div> -->
  <header class="header">
    <div class="header-inner">
      <h1 class="logo">
        <a href="{{ url_for('index') }}">ì—°êµ¬ë…¸íŠ¸ ë·°ì–´</a>
      </h1>

      <nav class="header-nav">
        <a href="{{ url_for('global_search') }}">ğŸ” ì „ì—­ ê²€ìƒ‰</a>
        <a href="{{ url_for('tasks_view') }}">âœ… í•  ì¼</a>
        <a href="{{ url_for('debug_log') }}">ğŸ“œ ë¡œê·¸</a>

        {# âœ… ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´ê°€ ì—†ê±°ë‚˜ session í‚¤ê°€ ì—†ì„ ë•Œë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ #}
        {% if 'session' in request.scope and request.scope['session'].get('user') %}
          <span class="header-user">
            ë¡œê·¸ì¸: {{ request.scope['session'].get('user') }}
          </span>
          <a href="{{ url_for('logout') }}" class="top-nav-link">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
        {% else %}
          <a href="{{ url_for('login_page') }}" class="top-nav-link">ë¡œê·¸ì¸</a>
        {% endif %}

        <button id="theme-toggle" title="ë¼ì´íŠ¸/ë‹¤í¬ ì „í™˜">ğŸŒ™</button>
      </nav>
    </div>
  </header>

  <main class="main">
    <!-- âœ… ëª¨ë°”ì¼/PC ê³µí†µ ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ -->
    <div class="main-inner">
      {% block content %}{% endblock %}
    </div>
  </main>

  <script>
    // ë‹¤í¬ ëª¨ë“œ í† ê¸€
    (function() {
      const body = document.body;
      const btn = document.getElementById('theme-toggle');
      const saved = localStorage.getItem('nv_theme') || 'light';
      if (saved === 'dark') {
        body.classList.add('dark');
        if (btn) btn.textContent = 'â˜€ï¸';
      }
      if (btn) {
        btn.addEventListener('click', function() {
          const isDark = body.classList.toggle('dark');
          localStorage.setItem('nv_theme', isDark ? 'dark' : 'light');
          btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        });
      }
    })();

    // ì—ë””í„° í˜ì´ì§€ ë‹¨ì¶•í‚¤: Ctrl+S â†’ ì €ì¥
    (function() {
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && (e.key === 's' || e.key === 'S')) {
          const form = document.querySelector('form.editor-form');
          if (form) {
            e.preventDefault();
            form.submit();
          }
        }
      });
    })();
  </script>
</body>
</html>
